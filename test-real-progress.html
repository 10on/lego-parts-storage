<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест реального прогресс-бара</title>
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/loading-progress.css">
</head>
<body>
    <div class="container">
        <h1>Тест реального прогресс-бара</h1>
        <p>Этот тест имитирует реальную загрузку данных BrickLink с прогресс-баром</p>
        <button id="test-real-progress-btn" class="btn btn-primary">Запустить реальный тест</button>
        <div id="test-results"></div>
    </div>

    <script src="src/ui/components/LoadingProgress.js"></script>
    <script>
        // Имитируем реальную загрузку данных
        async function simulateRealDataLoading() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Запуск реального теста...</p>';
            
            // Создаем прогресс-бар как в реальном приложении
            const progress = LoadingProgress.createLCXProgress();
            
            try {
        // Имитируем реальные этапы загрузки
        
        // Этап 1: Инициализация базы данных
        progress.updateStep(0, 0, 'Создание таблиц...');
        await new Promise(resolve => setTimeout(resolve, 200));
        progress.updateStep(0, 50, 'Таблицы созданы');
        await new Promise(resolve => setTimeout(resolve, 200));
        progress.completeStep(0, 'База данных готова');
                
                // Этап 2: Скачивание файла данных
                progress.updateStep(1, 0, 'Подключение к серверу...');
                await new Promise(resolve => setTimeout(resolve, 200));
                progress.updateStep(1, 25, 'Соединение установлено');
                await new Promise(resolve => setTimeout(resolve, 200));
                progress.updateStep(1, 75, 'Скачивание файла...');
                await new Promise(resolve => setTimeout(resolve, 600));
                progress.completeStep(1, 'Файл скачан');
                
                // Этап 3: Распаковка архива
                progress.updateStep(2, 0, 'Извлечение данных...');
                await new Promise(resolve => setTimeout(resolve, 300));
                progress.updateStep(2, 50, 'Данные извлечены');
                await new Promise(resolve => setTimeout(resolve, 300));
                progress.completeStep(2, 'Архив распакован');
                
                // Этап 4: Парсинг JSON данных
                progress.updateStep(3, 0, 'Обработка структуры...');
                await new Promise(resolve => setTimeout(resolve, 200));
                progress.updateStep(3, 50, 'Структура обработана');
                await new Promise(resolve => setTimeout(resolve, 200));
                progress.completeStep(3, 'Данные обработаны');
                
                // Этап 5: Загрузка категорий
                progress.updateStep(4, 0, 'Сохранение категорий...');
                await new Promise(resolve => setTimeout(resolve, 100));
                progress.updateStep(4, 50, 'Категории обрабатываются');
                await new Promise(resolve => setTimeout(resolve, 100));
                progress.completeStep(4, 'Категории загружены');
                
                // Этап 6: Загрузка цветов
                progress.updateStep(5, 0, 'Сохранение цветов...');
                await new Promise(resolve => setTimeout(resolve, 100));
                progress.updateStep(5, 50, 'Цвета обрабатываются');
                await new Promise(resolve => setTimeout(resolve, 50));
                progress.completeStep(5, 'Цвета загружены');
                
                // Этап 7: Загрузка деталей (самый долгий)
                progress.updateStep(6, 0, 'Начинаем загрузку деталей...');
                
                // Имитируем реальную загрузку деталей с прогрессом
                for (let i = 0; i <= 100; i += 2) {
                    progress.updateStep(6, i, `Сохранено ${Math.floor(i * 897.83)} из 89783 деталей`);
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
                
                progress.completeStep(6, 'Детали загружены');
                
                // Этап 8: Создание индексов
                progress.updateStep(7, 100, 'Построение индексов...');
                await new Promise(resolve => setTimeout(resolve, 300));
                progress.completeStep(7, 'Индексы созданы');
                
                // Этап 9: Завершение
                progress.updateStep(8, 100, 'Финализация...');
                await new Promise(resolve => setTimeout(resolve, 200));
                progress.completeStep(8, 'Готово: 89783 деталей, 213 цветов');
                
                // Скрываем прогресс через 2 секунды
                setTimeout(() => {
                    progress.hide();
                    resultsDiv.innerHTML = '<p style="color: green;">✅ Реальный тест завершен успешно! Прогресс-бар работал плавно на всех этапах.</p>';
                }, 2000);
                
            } catch (error) {
                console.error('Ошибка теста:', error);
                resultsDiv.innerHTML = `<p style="color: red;">❌ Ошибка: ${error.message}</p>`;
            }
        }

        document.getElementById('test-real-progress-btn').addEventListener('click', simulateRealDataLoading);
    </script>
</body>
</html>
