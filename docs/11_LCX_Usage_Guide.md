# Руководство по использованию LCX-Tabular формата

## Обзор

LCX-Tabular формат теперь полностью интегрирован в приложение LEGO Parts Storage. Это эффективный способ импорта и экспорта каталога деталей BrickLink с существенной экономией трафика и быстрой обработкой.

## Возможности

### ✅ Импорт LCX файлов
- Поддержка формата LCX-Tabular v1
- Автоматическое определение LCX файлов по расширению
- Валидация структуры данных
- Поддержка сжатых файлов (.gz)
- Поточная обработка больших файлов

### ✅ Экспорт в LCX формат
- Экспорт текущих данных в LCX формат
- Сохранение всех связей между таблицами
- Поддержка полной схемы LCX v1

### ✅ Интеграция с IndexedDB
- Автоматическое создание/обновление схемы базы данных
- Поддержка связей деталь-цвет
- Быстрый поиск и автодополнение
- Статистика загруженных данных

## Как использовать

### 1. Импорт LCX файла

1. Перейдите в раздел **Импорт/Экспорт**
2. Нажмите **"Выберите файл"** и выберите LCX файл:
   - `catalog.lcx.json` - несжатый LCX файл
   - `catalog.lcx.json.gz` - сжатый LCX файл  
   - `catalog.lctx.json` - альтернативное расширение
3. Включите **"Валидировать данные"** для проверки структуры
4. Нажмите **"Импортировать"**

### 2. Экспорт в LCX формат

1. Убедитесь, что у вас есть данные BrickLink (импортированные из LCX)
2. В разделе **Импорт/Экспорт** нажмите **"Экспорт LCX"**
3. Будет создан файл `bricklink-catalog.lcx.json`

### 3. Автоматическая загрузка данных

- При запуске приложения автоматически проверяется наличие LCX данных
- Если LCX данные найдены, они используются для поиска деталей
- Fallback к старым CSV файлам при отсутствии LCX данных

## Технические детали

### Структура базы данных

Приложение создает следующие таблицы в IndexedDB:

- **categories** - категории деталей (id, name)
- **colors** - цвета (id, name, rgb, type, parts, inSets, wanted, forSale, yearFrom, yearTo)  
- **parts** - детали (partId, blId, name, catId, alt)
- **partColors** - связи деталь-цвет (partId, colorId, hasImg)
- **metadata** - метаданные импорта

### Поддерживаемые форматы файлов

- `.lcx.json` - LCX-Tabular JSON формат
- `.lctx.json` - альтернативное расширение
- `.lcx.json.gz` - сжатый gzip формат
- `.lctx.json.gz` - сжатый gzip формат (альтернативное расширение)

### Валидация данных

Парсер автоматически проверяет:
- Версию схемы (поддерживается v1)
- Наличие обязательных таблиц и полей
- Соответствие количества колонок и значений
- Валидность RGB значений для цветов
- Ссылочную целостность между таблицами

## Производительность

### Преимущества LCX формата:
- **Экономия трафика**: 25-45% по сравнению с NDJSON
- **Быстрый парсинг**: табличная структура оптимизирована для обработки
- **Эффективное хранение**: IndexedDB оптимизирован для bulk-операций
- **Поточная обработка**: не требует загрузки всех данных в память

### Рекомендации:
- Используйте сжатые файлы (.gz) для максимальной экономии
- Включайте валидацию при импорте новых источников данных
- Регулярно экспортируйте данные для резервного копирования

## Примеры использования

### Создание тестового LCX файла

В корне проекта есть файл `test-catalog.lcx.json` с примером структуры:
- 5 категорий деталей
- 5 основных цветов  
- 10 популярных деталей
- Связи деталь-цвет для некоторых комбинаций

### Интеграция с API

```javascript
// Создание LCX адаптера
const lcxAdapter = new LCXIndexedDBAdapter();
await lcxAdapter.init();

// Загрузка LCX файла
const stats = await lcxAdapter.loadFromLCX(lcxFile);
console.log('Загружено:', stats);

// Поиск деталей
const parts = await lcxAdapter.searchParts('brick');
const colors = await lcxAdapter.searchColors('red');
```

## Миграция с TSV формата

При первом импорте LCX файла:
1. Старые TSV данные автоматически заменяются
2. Новая схема базы данных создается/обновляется  
3. Все существующие функции поиска продолжают работать
4. Производительность поиска улучшается

Никаких изменений в пользовательском интерфейсе не требуется - все работает автоматически!

## Устранение неполадок

### Ошибки импорта:
- **"Неподдерживаемая версия схемы"** - используйте LCX v1 формат
- **"Отсутствует обязательная таблица"** - проверьте наличие categories, colors, parts
- **"Некорректная структура"** - убедитесь в правильности JSON синтаксиса

### Ошибки экспорта:
- **"Нет данных для экспорта"** - сначала импортируйте LCX файл
- **"Ошибка доступа к базе данных"** - перезагрузите страницу

### Проблемы производительности:
- Большие файлы (>50MB) могут занять несколько минут на обработку
- При возникновении проблем с памятью используйте сжатые файлы
- Очистите кэш браузера при проблемах с IndexedDB
