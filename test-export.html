<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Export</title>
</head>
<body>
    <h1>–¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ JSON</h1>
    <button id="test-export">–¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞</button>
    <div id="result"></div>

    <script>
        // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é —ç–∫—Å–ø–æ—Ä—Ç–∞
        function testExport() {
            console.log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —ç–∫—Å–ø–æ—Ä—Ç...');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ localStorage
            localStorage.setItem('lego-storage-project', JSON.stringify({
                name: 'Test Project',
                version: '1.0',
                createdAt: new Date().toISOString()
            }));
            
            localStorage.setItem('lego-storage-containers', JSON.stringify([
                { id: '1', name: 'Test Container', cells: [] }
            ]));
            
            localStorage.setItem('lego-storage-settings', JSON.stringify({
                theme: 'light',
                language: 'ru'
            }));
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            const data = {
                project: getLocalStorageData('lego-storage-project'),
                containers: getLocalStorageData('lego-storage-containers'),
                snapshots: getLocalStorageData('lego-storage-snapshots'),
                settings: getLocalStorageData('lego-storage-settings'),
                imageCache: getLocalStorageData('lego-storage-image-cache'),
                exportedAt: new Date().toISOString(),
                version: '1.0',
                exportType: 'full-localStorage-backup'
            };
            
            console.log('üì¶ –î–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:', data);
            
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            downloadFile(blob, 'test-export.json');
            
            document.getElementById('result').innerHTML = '<p style="color: green;">‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏ –∑–∞–≥—Ä—É–∑–∫–∏.</p>';
        }
        
        function getLocalStorageData(key) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : null;
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage –¥–ª—è –∫–ª—é—á–∞ ${key}:`, error);
                return null;
            }
        }
        
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        document.getElementById('test-export').addEventListener('click', testExport);
    </script>
</body>
</html>
